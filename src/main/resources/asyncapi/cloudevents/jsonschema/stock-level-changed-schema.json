{
  "$id": "com.paklog.inventory.fulfillment.v1.product-stock.level-changed",
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Stock Level Changed Event",
  "description": "Published when product stock levels change due to receipts, adjustments, allocations, or picks. This is the primary domain event for the Inventory Bounded Context, enabling downstream services to react to inventory state changes. The event includes both before and after snapshots of the stock position, along with the reason for the change, supporting audit trails and analytics.",
  "type": "object",
  "required": ["sku", "previous_quantity_on_hand", "new_quantity_on_hand", "change_reason"],
  "properties": {
    "sku": {
      "type": "string",
      "description": "Stock Keeping Unit identifier - the unique product code within the inventory system",
      "example": "SKU-12345"
    },
    "previous_quantity_on_hand": {
      "type": "integer",
      "description": "Total physical quantity in the warehouse before the change. This represents the actual countable inventory regardless of allocation status.",
      "minimum": 0,
      "example": 100
    },
    "previous_quantity_allocated": {
      "type": "integer",
      "description": "Quantity reserved for pending orders before the change. These items are physically present but committed to specific orders awaiting fulfillment.",
      "minimum": 0,
      "example": 20
    },
    "previous_available_to_promise": {
      "type": "integer",
      "description": "Quantity available for new sales before the change. Calculated as quantity_on_hand minus quantity_allocated. This is the key metric for sales availability.",
      "minimum": 0,
      "example": 80
    },
    "new_quantity_on_hand": {
      "type": "integer",
      "description": "Total physical quantity in the warehouse after the change",
      "minimum": 0,
      "example": 150
    },
    "new_quantity_allocated": {
      "type": "integer",
      "description": "Quantity reserved for pending orders after the change",
      "minimum": 0,
      "example": 30
    },
    "new_available_to_promise": {
      "type": "integer",
      "description": "Quantity available for new sales after the change",
      "minimum": 0,
      "example": 120
    },
    "change_reason": {
      "type": "string",
      "description": "Categorical reason for the stock level change, used for audit trails, analytics, and business rule enforcement",
      "enum": ["RECEIPT", "ADJUSTMENT", "ALLOCATION", "PICK", "RETURN", "TRANSFER", "CYCLE_COUNT"],
      "example": "RECEIPT"
    }
  }
}
