{{- if not .Values.externalSecrets.enabled }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "inventory-service.fullname" . }}-secret
  labels:
    {{- include "inventory-service.labels" . | nindent 4 }}
type: Opaque
data:
  # MongoDB URI with credentials
  {{- if and .Values.secrets.mongodb.username .Values.secrets.mongodb.password }}
  mongodb-uri: {{ printf "mongodb://%s:%s@%s" .Values.secrets.mongodb.username .Values.secrets.mongodb.password (trimPrefix "mongodb://" .Values.config.mongodb.uri) | b64enc | quote }}
  {{- else }}
  mongodb-uri: {{ .Values.config.mongodb.uri | b64enc | quote }}
  {{- end }}

  # Redis password
  {{- if .Values.secrets.redis.password }}
  redis-password: {{ .Values.secrets.redis.password | b64enc | quote }}
  {{- else }}
  redis-password: {{ "" | b64enc | quote }}
  {{- end }}

  # Kafka credentials (if secured)
  {{- if .Values.secrets.kafka.username }}
  kafka-username: {{ .Values.secrets.kafka.username | b64enc | quote }}
  {{- end }}
  {{- if .Values.secrets.kafka.password }}
  kafka-password: {{ .Values.secrets.kafka.password | b64enc | quote }}
  {{- end }}
{{- end }}
